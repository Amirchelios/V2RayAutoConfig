# 🔗 Daily TrustLink Optimizer

## 📋 توضیحات

برنامه **Daily TrustLink Optimizer** یک ابزار خودکار است که هر روز در ساعت 00:00 UTC (03:30 تهران) اجرا می‌شود و کانفیگ‌های TrustLink را بهینه‌سازی می‌کند.

## 🎯 هدف

این برنامه:
- تمام کانفیگ‌های موجود در `trustlink.txt` را تست می‌کند
- بهترین 10 کانفیگ را بر اساس سرعت اتصال و دانلود انتخاب می‌کند
- بقیه کانفیگ‌ها را حذف می‌کند
- فایل TrustLink را با بهترین کانفیگ‌ها به‌روزرسانی می‌کند

## ⚙️ ویژگی‌ها

### 🔧 تست اتصال
- تست اتصال با استفاده از Xray
- اندازه‌گیری latency (زمان پاسخ)
- تست سرعت دانلود
- پشتیبانی از پروتکل‌های: VMess, VLESS, Trojan, Shadowsocks

### 📊 سیستم امتیازدهی
- **70% وزن برای latency**: هر 10ms = 1 امتیاز کمتر
- **30% وزن برای سرعت دانلود**: هر 10 KB/s = 1 امتیاز
- انتخاب بهترین کانفیگ‌ها بر اساس امتیاز کلی

### 🚀 اجرای خودکار
- اجرای روزانه در ساعت 00:00 UTC
- امکان اجرای دستی از طریق GitHub Actions
- گزارش‌گیری کامل از نتایج

## 📁 ساختار فایل‌ها

```
daily-tester/
├── daily_trustlink_tester.py    # اسکریپت اصلی
├── README.md                    # این فایل
├── logs/
│   └── daily_tester.log         # لاگ‌های اجرا
└── output/
    ├── trustlink_tested.txt     # بهترین کانفیگ‌ها
    └── .test_results.json       # نتایج تست
```

## 🔄 نحوه کار

### 1. بارگذاری کانفیگ‌ها
- خواندن تمام کانفیگ‌ها از `trustlink/trustlink.txt`
- فیلتر کردن کانفیگ‌های نامعتبر

### 2. تست همزمان
- تست 5 کانفیگ به صورت همزمان
- timeout 10 ثانیه برای هر تست
- اندازه‌گیری latency و سرعت دانلود

### 3. انتخاب بهترین‌ها
- محاسبه امتیاز برای هر کانفیگ
- انتخاب 10 کانفیگ برتر
- ذخیره در `output/trustlink_tested.txt`

### 4. به‌روزرسانی
- جایگزینی فایل اصلی TrustLink
- ثبت تغییرات در Git
- ایجاد گزارش کامل

## 📈 نتایج

### فایل‌های خروجی
- **`trustlink_tested.txt`**: 10 کانفیگ برتر
- **`.test_results.json`**: آمار کامل تست
- **`daily_tester.log`**: لاگ‌های اجرا

### آمار تست
```json
{
  "total_configs": 150,
  "successful": 45,
  "failed": 105,
  "best_configs": 10,
  "protocol_stats": {
    "vmess": {"total": 80, "successful": 25},
    "vless": {"total": 40, "successful": 15},
    "trojan": {"total": 30, "successful": 5}
  }
}
```

## 🛠️ تنظیمات

### متغیرهای قابل تنظیم
```python
TEST_TIMEOUT = 10          # ثانیه
CONCURRENT_TESTS = 5       # تعداد تست همزمان
KEEP_BEST_COUNT = 10       # تعداد کانفیگ‌های نگه‌داری شده
```

### پروتکل‌های پشتیبانی شده
- `vmess://`
- `vless://`
- `trojan://`
- `ss://`

## 🔧 نصب و راه‌اندازی

### پیش‌نیازها
- Python 3.9+
- Xray binary
- aiohttp, beautifulsoup4, pytz, jdatetime

### اجرای دستی
```bash
cd daily-tester
python daily_trustlink_tester.py
```

### اجرای خودکار
برنامه به صورت خودکار هر روز در ساعت 00:00 UTC اجرا می‌شود.

## 📊 نظارت

### GitHub Actions
- مشاهده نتایج در Actions tab
- دانلود artifacts
- بررسی لاگ‌ها

### گزارش‌گیری
- خلاصه کامل در GitHub Actions
- آمار پروتکل‌ها
- زمان اجرا و نتیجه

## 🔍 عیب‌یابی

### مشکلات رایج
1. **Xray binary یافت نشد**: بررسی وجود فایل در `Files/xray-bin/`
2. **تست ناموفق**: بررسی اتصال اینترنت و تنظیمات فایروال
3. **Timeout**: افزایش `TEST_TIMEOUT` در صورت نیاز

### لاگ‌ها
تمام اطلاعات در `logs/daily_tester.log` ذخیره می‌شود.

## 📝 تغییرات

### نسخه 1.0.0
- تست اتصال با Xray
- سیستم امتیازدهی
- انتخاب بهترین 10 کانفیگ
- اجرای خودکار روزانه

## 🤝 مشارکت

برای بهبود این برنامه:
1. Fork کنید
2. تغییرات را اعمال کنید
3. Pull Request ارسال کنید

## 📄 لایسنس

این پروژه تحت لایسنس MIT منتشر شده است.
